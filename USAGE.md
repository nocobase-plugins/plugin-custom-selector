# CustomSelector ä½¿ç”¨æŒ‡å—

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…æ’ä»¶

åœ¨ NocoBase ç®¡ç†ç•Œé¢ä¸­ï¼š
1. è¿›å…¥ **æ’ä»¶ç®¡ç†**
2. æ‰¾åˆ° **Custom Selector** æ’ä»¶
3. ç‚¹å‡» **å¯ç”¨**

### 2. é…ç½®å…³è”å­—æ®µ

#### æ­¥éª¤ä¸€ï¼šåˆ›å»ºæ•°æ®è¡¨
å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªæ•°æ®è¡¨ï¼š
- `users` (ç”¨æˆ·è¡¨)
- `departments` (éƒ¨é—¨è¡¨)

#### æ­¥éª¤äºŒï¼šæ·»åŠ å…³è”å­—æ®µ
åœ¨ç”¨æˆ·è¡¨ä¸­æ·»åŠ ä¸€ä¸ªå…³è”å­—æ®µï¼š
1. è¿›å…¥ç”¨æˆ·è¡¨çš„å­—æ®µé…ç½®
2. æ·»åŠ æ–°å­—æ®µï¼Œç±»å‹é€‰æ‹© **å…³è”å­—æ®µ**
3. é…ç½®å…³è”ç›®æ ‡ä¸º `departments` è¡¨
4. è®¾ç½®å…³è”ç±»å‹ï¼ˆå¦‚ï¼šå¤šå¯¹ä¸€ï¼‰

#### æ­¥éª¤ä¸‰ï¼šå¯ç”¨è‡ªå®šä¹‰é€‰æ‹©å™¨
1. åœ¨è¡¨å•è®¾è®¡å™¨ä¸­é€‰æ‹©å…³è”å­—æ®µ
2. åœ¨å­—æ®µè®¾ç½®ä¸­æ‰¾åˆ° **Custom Selector** å¼€å…³
3. å¼€å¯è¯¥åŠŸèƒ½

## åŠŸèƒ½æ¼”ç¤º

### åŸºæœ¬é€‰æ‹©åŠŸèƒ½
```typescript
// å­—æ®µé…ç½®ç¤ºä¾‹
{
  "type": "string",
  "x-component": "AssociationField",
  "x-component-props": {
    "mode": "CustomSelector",
    "enableCustomSelector": true
  },
  "x-collection-field": "department"
}
```

### æœç´¢åŠŸèƒ½
- åœ¨å¼¹å‡ºçš„é€‰æ‹©å™¨ä¸­è¾“å…¥å…³é”®è¯
- ç³»ç»Ÿä¼šè‡ªåŠ¨åœ¨åç«¯è¿›è¡Œæ¨¡ç³Šæœç´¢
- æ”¯æŒå®æ—¶æœç´¢ï¼Œ300ms é˜²æŠ–

### åˆ†é¡µåŠŸèƒ½
- é»˜è®¤æ¯é¡µæ˜¾ç¤º 10 æ¡è®°å½•
- æ”¯æŒé¡µç è·³è½¬
- æ˜¾ç¤ºæ€»æ•°ç»Ÿè®¡

### ä¸°å¯Œçš„åˆ—è¡¨é¡¹æ˜¾ç¤º
æ’ä»¶æ”¯æŒæ™ºèƒ½è¯†åˆ«å’Œæ˜¾ç¤ºå¤šç§ä¿¡æ¯ï¼š

#### å¤´åƒæ˜¾ç¤º
- è‡ªåŠ¨è¯†åˆ«æ ‡å‡†å¤´åƒå­—æ®µï¼š`avatar`ã€`photo`ã€`image`ã€`picture`
- æ”¯æŒè‡ªå®šä¹‰å­—æ®µï¼ˆå¦‚ï¼š`f_wh29qtsrvv1`ï¼‰
- å¦‚æœæ²¡æœ‰å¤´åƒï¼Œæ˜¾ç¤ºå§“åé¦–å­—æ¯

#### ä¸»è¦ä¿¡æ¯æ˜¾ç¤º
ä¼˜å…ˆçº§é¡ºåºï¼š
1. `targetKey` å­—æ®µï¼ˆå…³è”å­—æ®µé…ç½®çš„æ˜¾ç¤ºå­—æ®µï¼‰
2. `name` å­—æ®µ
3. `title` å­—æ®µ
4. `label` å­—æ®µ
5. `nickname` å­—æ®µï¼ˆæ˜µç§°ï¼‰
6. `username` å­—æ®µï¼ˆç”¨æˆ·åï¼‰
7. `displayName` å­—æ®µ
8. `id` å­—æ®µ

#### æ¬¡è¦ä¿¡æ¯æ˜¾ç¤º
è‡ªåŠ¨ç»„åˆä»¥ä¸‹ä¿¡æ¯ï¼ˆç”¨ " - " åˆ†éš”ï¼‰ï¼š
- **ç»„ç»‡ä¿¡æ¯**: `department`ã€`organization`ã€`company`
- **èŒä½ä¿¡æ¯**: `position`ã€`role`ã€`title`
- **è”ç³»ä¿¡æ¯**: `email`ã€`phone`
- **ç¼–å·ä¿¡æ¯**: `code`ã€`number`

#### æ•°æ®ç»“æ„ç¤ºä¾‹
```json
{
  "id": 4,
  "nickname": "è‘£æ¶›",
  "username": "111",
  "email": "111@nocobase.com",
  "phone": "19916710075",
  "f_wh29qtsrvv1": "https://avatars.githubusercontent.com/u/3371163?v=4",
  "department": "æ‰‹æœºéƒ¨-æ™ºèƒ½åˆ¶é€ éƒ¨-è½¯ä»¶å·¥ç¨‹éƒ¨-å·¥ä¸šå¹³å°ç»„",
  "position": "é«˜çº§å·¥ç¨‹å¸ˆ"
}
```

ä¸Šè¿°æ•°æ®ä¼šæ˜¾ç¤ºä¸ºï¼š
- **å¤´åƒ**: æ¥è‡ª `f_wh29qtsrvv1` å­—æ®µçš„å›¾ç‰‡
- **ä¸»è¦ä¿¡æ¯**: "è‘£æ¶›" (æ¥è‡ª `nickname` å­—æ®µ)
- **æ¬¡è¦ä¿¡æ¯**: "æ‰‹æœºéƒ¨-æ™ºèƒ½åˆ¶é€ éƒ¨-è½¯ä»¶å·¥ç¨‹éƒ¨-å·¥ä¸šå¹³å°ç»„ - é«˜çº§å·¥ç¨‹å¸ˆ - 111@nocobase.com - 19916710075"

## é«˜çº§é…ç½®

### è‡ªå®šä¹‰æ˜¾ç¤ºå­—æ®µ
æ’ä»¶ä¼šè‡ªåŠ¨è¯†åˆ«ç›®æ ‡è¡¨çš„ä¸»è¦æ˜¾ç¤ºå­—æ®µï¼š
1. ä¼˜å…ˆä½¿ç”¨ `targetKey` å­—æ®µ
2. å…¶æ¬¡å°è¯• `name` å­—æ®µ
3. å†æ¬¡å°è¯• `title` å­—æ®µ
4. æœ€åä½¿ç”¨ `label` å­—æ®µ
5. å¦‚æœéƒ½æ²¡æœ‰ï¼Œåˆ™æ˜¾ç¤º `id`

### å…³è”ç±»å‹æ”¯æŒ
- **ä¸€å¯¹ä¸€ (OneToOne)**: é€‰æ‹©å•ä¸ªè®°å½•
- **å¤šå¯¹ä¸€ (ManyToOne)**: ä»å¤šä¸ªé€‰é¡¹ä¸­é€‰æ‹©ä¸€ä¸ª
- **ä¸€å¯¹å¤š (OneToMany)**: æ”¯æŒé€‰æ‹©å¤šä¸ªè®°å½•
- **å¤šå¯¹å¤š (ManyToMany)**: æ”¯æŒé€‰æ‹©å¤šä¸ªè®°å½•

### è¿‡æ»¤æ¡ä»¶
å¯¹äºä¸€å¯¹ä¸€å’Œä¸€å¯¹å¤šå…³è”ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨æ·»åŠ è¿‡æ»¤æ¡ä»¶ï¼š
```sql
WHERE foreign_key IS NULL OR foreign_key = current_record_id
```

### æ ·å¼è‡ªå®šä¹‰
åˆ—è¡¨é¡¹é‡‡ç”¨å¡ç‰‡å¼å¸ƒå±€ï¼š
- å¤´åƒå°ºå¯¸ï¼š40px
- ä¸»è¦æ–‡æœ¬ï¼š14pxï¼Œç²—ä½“ï¼Œæ·±è‰²
- æ¬¡è¦æ–‡æœ¬ï¼š12pxï¼Œå¸¸è§„ï¼Œç°è‰²
- æ”¯æŒæ–‡æœ¬æº¢å‡ºçœç•¥
- é¼ æ ‡æ‚¬åœé«˜äº®æ•ˆæœ

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. é€‰æ‹©å™¨æ— æ³•æ‰“å¼€
**åŸå› **: å…³è”å­—æ®µé…ç½®ä¸æ­£ç¡®
**è§£å†³**: æ£€æŸ¥å­—æ®µçš„ `x-collection-field` é…ç½®

#### 2. æœç´¢æ— ç»“æœ
**åŸå› **: ç›®æ ‡è¡¨ç¼ºå°‘å¯æœç´¢å­—æ®µ
**è§£å†³**: ç¡®ä¿ç›®æ ‡è¡¨åŒ…å« `name`ã€`title` æˆ– `label` å­—æ®µ

#### 3. æ•°æ®ä¸æ˜¾ç¤º
**åŸå› **: æƒé™ä¸è¶³æˆ–ç›®æ ‡è¡¨ä¸ºç©º
**è§£å†³**: æ£€æŸ¥ç”¨æˆ·æƒé™å’Œç›®æ ‡è¡¨æ•°æ®

#### 4. å¤´åƒä¸æ˜¾ç¤º
**åŸå› **: å¤´åƒå­—æ®µé…ç½®é—®é¢˜
**è§£å†³**: 
- æ£€æŸ¥å¤´åƒå­—æ®µæ˜¯å¦åŒ…å«æœ‰æ•ˆçš„URL
- ç¡®è®¤å­—æ®µåæ˜¯å¦ç¬¦åˆè¯†åˆ«è§„åˆ™
- éªŒè¯å›¾ç‰‡URLæ˜¯å¦å¯è®¿é—®

#### 5. æ¬¡è¦ä¿¡æ¯ä¸å®Œæ•´
**åŸå› **: æ•°æ®å­—æ®µç¼ºå¤±
**è§£å†³**: 
- æ£€æŸ¥ç›®æ ‡è¡¨æ˜¯å¦åŒ…å«ç›¸å…³å­—æ®µ
- ç¡®è®¤å­—æ®µæ•°æ®æ˜¯å¦å®Œæ•´
- éªŒè¯å­—æ®µå‘½åæ˜¯å¦ç¬¦åˆè§„èŒƒ

### è°ƒè¯•ä¿¡æ¯
æ’ä»¶ä¼šåœ¨æµè§ˆå™¨æ§åˆ¶å°è¾“å‡ºè°ƒè¯•ä¿¡æ¯ï¼š
```javascript
console.warn('CustomSelector: æœªæ‰¾åˆ°å…³è”å­—æ®µé…ç½®æˆ–ç›®æ ‡è¡¨', {
  fieldSchema: fieldSchema?.name,
  collectionField
});
```

## API å‚è€ƒ

### CustomSelector ç»„ä»¶å±æ€§

| å±æ€§å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `value` | `any` | - | å½“å‰é€‰ä¸­çš„å€¼ |
| `onChange` | `(value: any) => void` | - | å€¼å˜åŒ–å›è°ƒ |
| `placeholder` | `string` | è‡ªåŠ¨ç¿»è¯‘ | è¾“å…¥æ¡†å ä½ç¬¦ |

### æŸ¥è¯¢å‚æ•°ç»“æ„
```typescript
interface QueryParams {
  page: number;           // å½“å‰é¡µç 
  pageSize: number;       // æ¯é¡µå¤§å°
  filter?: {              // è¿‡æ»¤æ¡ä»¶
    [field: string]: {
      $includes: string;  // æ¨¡ç³Šæœç´¢
    };
  };
}
```

### å“åº”æ•°æ®ç»“æ„
```typescript
interface ResponseData {
  data: Array<any>;       // æ•°æ®åˆ—è¡¨
  meta: {
    count: number;        // æ€»æ•°
    page: number;         // å½“å‰é¡µ
    pageSize: number;     // æ¯é¡µå¤§å°
  };
}
```

### å­—æ®µè¯†åˆ«å‡½æ•°

#### å¤´åƒå­—æ®µè¯†åˆ«
```typescript
const getAvatarField = (item: any) => {
  // æŸ¥æ‰¾æ ‡å‡†å¤´åƒå­—æ®µ
  const avatarFields = ['avatar', 'photo', 'image', 'picture'];
  for (const field of avatarFields) {
    if (item[field]) return item[field];
  }
  
  // æŸ¥æ‰¾è‡ªå®šä¹‰å­—æ®µï¼ˆå¦‚ f_wh29qtsrvv1ï¼‰
  for (const key in item) {
    if (key.startsWith('f_') && typeof item[key] === 'string' && 
        (item[key].includes('http') || item[key].includes('avatar') || item[key].includes('image'))) {
      return item[key];
    }
  }
  return null;
};
```

#### ä¸»è¦æ–‡æœ¬è¯†åˆ«
```typescript
const getPrimaryText = (item: any) => {
  const labelField = collectionField?.targetKey || 'name' || 'title' || 'label';
  return item[labelField] || item.nickname || item.username || item.displayName || item.id;
};
```

#### æ¬¡è¦æ–‡æœ¬ç»„åˆ
```typescript
const getSecondaryText = (item: any) => {
  const parts = [];
  
  // ç»„ç»‡ä¿¡æ¯
  if (item.department) parts.push(item.department);
  if (item.organization) parts.push(item.organization);
  if (item.company) parts.push(item.company);
  
  // èŒä½ä¿¡æ¯
  if (item.position) parts.push(item.position);
  if (item.role) parts.push(item.role);
  
  // è”ç³»ä¿¡æ¯
  if (item.email) parts.push(item.email);
  if (item.phone) parts.push(item.phone);
  
  return parts.join(' - ');
};
```

## æœ€ä½³å®è·µ

### 1. æ€§èƒ½ä¼˜åŒ–
- ä¸ºç›®æ ‡è¡¨çš„æœç´¢å­—æ®µæ·»åŠ æ•°æ®åº“ç´¢å¼•
- åˆç†è®¾ç½®æ¯é¡µæ˜¾ç¤ºæ•°é‡
- ä½¿ç”¨é€‚å½“çš„è¿‡æ»¤æ¡ä»¶å‡å°‘æ•°æ®é‡
- ä¼˜åŒ–å¤´åƒå›¾ç‰‡å¤§å°å’Œæ ¼å¼

### 2. ç”¨æˆ·ä½“éªŒ
- ä¸ºå…³è”å­—æ®µè®¾ç½®æœ‰æ„ä¹‰çš„æ ‡é¢˜
- ç¡®ä¿ç›®æ ‡è¡¨æœ‰æ¸…æ™°çš„æ˜¾ç¤ºå­—æ®µ
- æä¾›é€‚å½“çš„å ä½ç¬¦æ–‡æœ¬
- ä½¿ç”¨é«˜è´¨é‡çš„å¤´åƒå›¾ç‰‡

### 3. æ•°æ®è®¾è®¡
- å…³è”è¡¨åº”è¯¥æœ‰æ˜ç¡®çš„ä¸»é”®
- æ˜¾ç¤ºå­—æ®µåº”è¯¥åŒ…å«æœ‰æ„ä¹‰çš„ä¿¡æ¯
- è€ƒè™‘æ·»åŠ æè¿°å­—æ®µæä¾›æ›´å¤šä¿¡æ¯
- è§„èŒƒåŒ–å­—æ®µå‘½åï¼ˆå¦‚ä½¿ç”¨ `department`ã€`position` ç­‰æ ‡å‡†å­—æ®µåï¼‰

### 4. å­—æ®µé…ç½®å»ºè®®
- **å¤´åƒå­—æ®µ**: ä½¿ç”¨æ ‡å‡†å‘½åæˆ– `f_` å‰ç¼€çš„è‡ªå®šä¹‰å­—æ®µ
- **ä¸»è¦æ˜¾ç¤ºå­—æ®µ**: ä¼˜å…ˆä½¿ç”¨ `name`ã€`title`ã€`nickname` ç­‰æœ‰æ„ä¹‰çš„å­—æ®µ
- **æ¬¡è¦ä¿¡æ¯å­—æ®µ**: åŒ…å« `department`ã€`position`ã€`email`ã€`phone` ç­‰è¡¥å……ä¿¡æ¯

## æ›´æ–°æ—¥å¿—

### v1.0.0 (å½“å‰ç‰ˆæœ¬)
- âœ… åŸºç¡€å…³è”æ•°æ®æŸ¥è¯¢
- âœ… å®æ—¶æœç´¢åŠŸèƒ½
- âœ… åˆ†é¡µå±•ç¤º
- âœ… å¤šè¯­è¨€æ”¯æŒ
- âœ… é˜²æŠ–ä¼˜åŒ–
- âœ… é”™è¯¯å¤„ç†
- âœ… æ™ºèƒ½å¤´åƒå’Œä¿¡æ¯æ˜¾ç¤º
- âœ… ä¸°å¯Œçš„åˆ—è¡¨é¡¹å¸ƒå±€

### è®¡åˆ’åŠŸèƒ½
- ğŸ”„ å¤šé€‰æ¨¡å¼æ”¯æŒ
- ğŸ”„ è‡ªå®šä¹‰æœç´¢å­—æ®µ
- ğŸ”„ é«˜çº§è¿‡æ»¤é€‰é¡¹
- ğŸ”„ è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–
- ğŸ”„ è‡ªå®šä¹‰åˆ—è¡¨é¡¹æ¨¡æ¿ 